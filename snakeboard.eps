%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 0 842 1190
%%Creator: Harald Boegeholz
%%Title: Prime number snake board
%%Pages: 1
%%EndComments

% Calculate the midpoint of the bounding box of a string
/stringMidpoint {
    gsave
    newpath
    0 0 moveto
    false charpath
    flattenpath
    pathbbox
    /ury exch def
    /urx exch def
    /lly exch def
    /llx exch def
    urx llx sub 2 div
    ury lly sub 2 div
    grestore
} def

% Show the string centered on the current point
/showCentered {
    dup stringMidpoint neg exch neg exch rmoveto
    show
} def

/paintSymbol
{
    exch 25 div 1 1 sethsbcolor
    gsave
    currentpoint newpath 7 0 360 arc
    gsave 1 setgray fill grestore
    0.8 setgray 0.5 setlinewidth stroke
    grestore
    /ZapfDingbats findfont 10 scalefont setfont showCentered
} def


% procedures to render a symbol for each prime at the current location
/primeProcedures
<<
  2 { 0 (2) paintSymbol }
  3 { 1 (3) paintSymbol }
  5 { 2 (5) paintSymbol }
  7 { 3 (7) paintSymbol }
  11 { 4 (11) paintSymbol }
  13 { 5 (13) paintSymbol }
  17 { 6 (17) paintSymbol }
  19 { 7 (19) paintSymbol }
  23 { 8 (23) paintSymbol }
  29 { 9 (29) paintSymbol }
  31 { 10 (31) paintSymbol }
  37 { 11 (37) paintSymbol }
  41 { 12 (41) paintSymbol }
  43 { 13 (43) paintSymbol }
  47 { 14 (47) paintSymbol }
  53 { 15 (53) paintSymbol }
  59 { 16 (59) paintSymbol }
  61 { 17 (61) paintSymbol }
  67 { 18 (67) paintSymbol }
  71 { 19 (71) paintSymbol }
  73 { 20 (73) paintSymbol }
  79 { 21 (79) paintSymbol }
  83 { 22 (83) paintSymbol }
  89 { 23 (89) paintSymbol }
  97 { 24 (97) paintSymbol }
>> def

/primeFactors {
  /number exch def
  /currentFactor 2 def
  [
    {
      number 1 eq
      { exit }
      {
        number currentFactor mod 0 eq
        {
          number currentFactor idiv
          /number exch def
          currentFactor
        }
        {
          /currentFactor currentFactor 1 add def
        } ifelse
      } ifelse
    } loop
  ]
} def



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% start drawing
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% recall BoundingBox: 0 0 842 1190
% leave 20pt on each edge, so the board will be 802 x 1150 pt
20 20 translate

/xstep 802 11 div def
/ystep 1150 10 div def

/sRadius xstep 0.3 mul def

% lower left corner of square number n
/nToLLCorner
{
    /n exch def
    n 1 sub 10 mod
    n 1 sub 10 idiv 2 mod 0 eq {1 add} { 9 exch sub } ifelse
    xstep mul
    n 10 idiv
    n 10 mod 0 eq { 0.5 sub } if
    ystep mul
} def

% /ZapfDingbats findfont 10 scalefont setfont
/numberFont
{
    /Helvetica findfont 10 scalefont setfont
} def

1 setlinewidth
% draw vertical grid lines
1 1 10
{ % for x
    xstep mul 0 moveto 0 10 ystep mul rlineto stroke
} for

3 setlinewidth
% draw horizontal grid lines
0 1 10
{ % for y
    ystep mul xstep exch moveto 9 xstep mul 0 rlineto stroke
} for

20 20 80
{ % for n
    nToLLCorner
    exch xstep add exch ystep 1.5 mul add moveto
    xstep -0.5 mul 0 xstep neg ystep -0.2 mul xstep neg ystep -0.5 mul rcurveto
    0 ystep neg rlineto
    0 ystep -0.3 mul xstep 0.5 mul ystep -0.5 mul xstep ystep -0.5 mul rcurveto
    stroke
    
} for

10 20 90
{ % for n
    nToLLCorner
    ystep -0.5 mul add moveto
    xstep 0.5 mul 0 xstep ystep 0.2 mul xstep ystep 0.5 mul rcurveto
    0 ystep rlineto
    0 ystep 0.3 mul xstep -0.5 mul ystep 0.5 mul xstep neg ystep 0.5 mul rcurveto
    stroke
} for

1 1 99
{ % for
    dup dup 2 string cvs exch
    nToLLCorner moveto

    gsave
    0.5 xstep mul 12 rmoveto
    0 setgray numberFont showCentered
    grestore

    0.5 xstep mul 0.5 ystep mul rmoveto

    primeFactors /pfs exch def
    pfs length /l exch def
    l 0 ne
    { % if
        l 1 eq
        { % ifelse
            pfs 0 get
            primeProcedures exch get exec
        }
        { % .. else
            gsave
            0.5 setlinewidth 0.8 setgray
            currentpoint newpath sRadius 0 360 arc
            stroke
            grestore

            360 l div /alpha exch def
            0 1 l 1 sub
            { % for
                gsave
                dup
                dup alpha mul cos sRadius mul exch alpha mul sin sRadius mul exch rmoveto
                pfs exch get
                primeProcedures exch get exec
                grestore
            } for
        } ifelse
    } if
} for

